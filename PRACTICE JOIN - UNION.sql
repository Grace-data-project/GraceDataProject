---BÀI TẬP 1: Tìm những đơn hàng mua sản phẩm 'Chip'
SELECT HD.*, SP.CategoryName
FROM MX_HOADON HD
INNER JOIN MX_SANPHAM SP
ON HD.ProductID = SP.ProductID
WHERE SP.CategoryName = 'Chip';

---BÀI TẬP 2: Tìm những đơn hàng được bán bởi nhân viên tên Linh
SELECT NV.EmName, HD.*
FROM MX_HOADON HD
LEFT JOIN MX_NHANVIEN NV
ON HD.SalesID = NV.EmID
WHERE NV.EmName LIKE N'%Linh';

---BÀI TẬP 3: 
----Tạo bảng HOADONMOI và thêm dữ liệu vào bảng
CREATE TABLE MX_HOADONMOI
 (OrderID char(5) NOT NULL,
  OrderLine int NOT NULL,
  SalesID char(5) NOT NULL,
  CusID char(5) NOT NULL,
  ProductID char(6) NOT NULL,
  Type varchar(10) NOT NULL,
  QTY int NOT NULL,
  Price int NOT NULL,
  TotalLine int NOT NULL, 
  DataCreate date NOT NULL,
  OrderDate date NOT NULL);
---Thêm khóa chính vào bảng MX_HOADONMOI
ALTER TABLE MX_HOADONMOI
ADD PRIMARY KEY (OrderLine);
---Thêm khóa ngoại-tham chiếu vào MX_HOADONMOI
ALTER TABLE MX_HOADONMOI
ADD FOREIGN KEY (SalesID) REFERENCES MX_NHANVIEN(EmID);

ALTER TABLE MX_HOADONMOI
ADD FOREIGN KEY (ProductID) REFERENCES MX_SANPHAM(ProductID);

----Thêm dữ liệu vào bảng
INSERT INTO MX_HOADONMOI VALUES
    ('HD028',31,'MX020','KH001','MXSP01','ONLINE',1,55,55,'2022-05-10','2022-05-06 '),
	('HD029',32,'MX020','KH001','MXSP02','ONLINE',2,50,100,'2022-05-10','2022-05-06 '),
	('HD030',33,'MX020','KH001','MXSP03','ONLINE',3,100,300,'2022-05-10','2022-05-06 '),
	('HD031',34,'MX023','KH004','MXSP04','OFFLINE',1,280,280,'2022-05-10','2022-05-06 '),
	('HD032',35,'MX024','KH005','MXSP05','OFFLINE',1,180,180,'2022-05-10','2022-05-06 '),
	('HD033',36,'MX025','KH006','MXSP06','OFFLINE',4,60,240,'2022-05-10','2022-05-06 '),
	('HD034',37,'MX023','KH006','MXSP07','OFFLINE',1,40,40,'2022-05-10','2022-05-06 '),
	('HD035',38,'MX023','KH006','MXSP08','OFFLINE',1,62,62,'2022-05-10','2022-05-06 '),
	('HD036',39,'MX023','KH006','MXSP09','OFFLINE',5,30,150,'2022-05-10','2022-05-06 '),
	('HD037',40,'MX023','KH006','MXSP10','OFFLINE',2,60,120,'2022-05-10','2022-05-06 '),
	('HD038',41,'MX026','KH006','MXSP11','ONLINE',2,80,160,'2022-05-10','2022-05-06 '),
	('HD039',42,'MX026','KH006','MXSP12','ONLINE',2,35,70,'2022-05-10','2022-05-06 '),
	('HD040',43,'MX020','KH006','MXSP13','ONLINE',3,30,90,'2022-05-10','2022-05-06 '),
	('HD041',44,'MX026','KH014','MXSP14','ONLINE',2,40,80,'2022-05-10','2022-05-06 '),
	('HD042',45,'MX021','KH015','MXSP15','ONLINE',2,25,50,'2022-05-10','2022-05-06 '),
	('HD043',46,'MX026','KH022','MXSP16','ONLINE',2,42,84,'2022-05-10','2022-05-06 '),
	('HD044',47,'MX023','KH015','MXSP17','ONLINE',2,80,160,'2022-05-10','2022-05-06 '),
	('HD045',48,'MX022','KH015','MXSP18','ONLINE',2,32,64,'2022-05-10','2022-05-06 '),
	('HD046',49,'MX026','KH015','MXSP19','ONLINE',2,60,120,'2022-05-10','2022-05-06 '),
	('HD047',50,'MX026','KH015','MXSP20','ONLINE',2,30,60,'2022-05-10','2022-05-06 '),
	('HD048',51,'MX026','KH021','MXSP21','ONLINE',1,59,59,'2022-05-10','2022-05-06 '),
	('HD049',52,'MX026','KH022','MXSP18','ONLINE',2,32,64,'2022-05-10','2022-05-06 '),
	('HD050',53,'MX026','KH023','MXSP19','ONLINE',2,60,120,'2022-05-10','2022-05-06 '),
	('HD051',54,'MX020','KH024','MXSP20','OFFLINE',2,30,60,'2022-05-10','2022-05-06 '),
	('HD052',55,'MX020','KH015','MXSP21','OFFLINE',5,59,295,'2022-05-10','2022-05-06 '),
	('HD053',56,'MX020','KH026','MXSP21','OFFLINE',3,59,177,'2022-05-10','2022-05-06 '),
	('HD054',57,'MX022','KH027','MXSP21','OFFLINE',2,59,118,'2022-05-10','2022-05-06 '),
	('HD055',58,'MX020','KH006','MXSP21','OFFLINE',1,59,59,'2022-05-10','2022-05-06 '),
	('HD056',59,'MX020','KH029','MXSP21','OFFLINE',1,59,59,'2022-05-10','2022-05-06 ');


--- Kết hợp dữ liệu từ bảng MX_HOADON và MX_HOADONMOI thành bảng tam thoi HOADONKETHOP và thêm nó vào bảng mới với tên MX_HOADONTONG
WITH HOADONKETHOP AS(
Select * from MX_HOADON
UNION ALL
SELECT * FROM MX_HOADONMOI)
SELECT * INTO MX_HOADONTONG
FROM HOADONKETHOP;

SELECT * FROM MX_HOADONTONG

---Làm bài tập 1 với bảng MX_HOADONTONG
SELECT HDT.*, SP.CategoryName
FROM MX_HOADONTONG HDT
INNER JOIN MX_SANPHAM SP
ON HDT.ProductID = SP.ProductID
WHERE SP.CategoryName = 'Chip';

---Làm bài tập 2 với bảng MX_HOADONTONG
SELECT NV.EmName, HDT.*
FROM MX_HOADONTONG HDT
LEFT JOIN MX_NHANVIEN NV
ON HDT.SalesID = NV.EmID
WHERE NV.EmName LIKE N'%Linh';


---BÀI TẬP 4: Tính khoảng thời gian tạo đơn hàng sau khi nhận được thông tin order từ khách
Select DATEDIFF(DAY, OrderDate, DataCreate) as NumberDate
FROM MX_HOADONTONG
GROUP BY DATEDIFF(DAY, OrderDate, DataCreate);

